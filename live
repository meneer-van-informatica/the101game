#!/usr/bin/env bash
set -euo pipefail
REPO=/root/the101game
SRC="$REPO/static"
WEBROOT=/var/www/vhosts/the101game.io/httpdocs
cd "$REPO"

echo "[LIVE] Pull rebase vanaf lmw/main"
git fetch lmw main || true
git pull --rebase --autostash lmw main || true

# Deploy static
[ -d "$SRC" ] && sudo rsync -a --delete "$SRC"/ "$WEBROOT"/

# Deploy VERSION.txt
[ -f "$REPO/VERSION.txt" ] && sudo install -m 644 "$REPO/VERSION.txt" "$WEBROOT/VERSION.txt"

# API restart
sudo systemctl restart the101game-api.service

# OFFLINE vlag weg
sudo rm -f /etc/nginx/.OFFLINE
sudo nginx -t && sudo systemctl reload nginx
echo "[LIVE] Site is online"
