<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>w0l0/4 (vierdeklasser)</title>
<style>
  :root{ --phone-w:min(100vw,420px); --bg:#000; --fg:#eaeaea; --line:#2a2a2a }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.45 ui-monospace,consolas,monospace}
  #phone{width:var(--phone-w);min-height:100dvh;margin:0 auto;display:flex;flex-direction:column}
  header{padding:12px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:8px}
  .btn{padding:.55rem .8rem;border:1px solid var(--line);border-radius:8px;color:var(--fg);text-decoration:none;background:#111}
  main{padding:12px;display:grid;gap:10px}
  /* page top timer */
  .page-meter{position:relative;padding:8px 10px 0}
  .pbar{position:relative;height:10px;width:82%;margin:0 auto;border:1px solid #333;border-radius:999px;overflow:hidden}
  .pfill{height:100%;width:100%;background:linear-gradient(90deg,#2ee670 0%, #e62e2e 100%)}
  .pval{position:absolute;top:-18px;right:calc(9%);font-size:.85rem;opacity:.9}
  #pspeed{position:absolute;top:-2px;left:10px;font:inherit;padding:.1rem .35rem;background:#111;color:#eaeaea;border:1px solid #333;border-radius:6px}
</style>
<body>
<div id="phone">
  <header>
    <span id="title">w0l0/4 (vierdeklasser)</span>
    <a class="btn" href="/">home</a>
  </header>

  <div class="page-meter">
    <select id="pspeed"><option value="5">5s</option><option value="10" selected>10s</option><option value="30">30s</option></select>
    <div class="pbar"><div id="pfill" class="pfill"></div><div class="pval"><span id="pval">1.0</span></div></div>
  </div>

  <main>
    <section class="card">
      <b>route</b>
      <p style="margin:.35rem 0 0 0">this is <code>w0l0/4 (vierdeklasser)</code>. timer will auto-advance.</p>
    </section>
  </main>
</div>

<script>(function(){
  var next = '/w0l1.html'; // default vervolg; pas aan wanneer je echte flow hebt
  var keyDur = 'timer:' + location.pathname;
  function getDur(){ try{ var v=parseInt(localStorage.getItem(keyDur)||'0',10); return (v>0?v:10);}catch(e){return 10;} }
  function setDur(s){ try{ localStorage.setItem(keyDur, String(s)); }catch(e){} }

  var ac, pre, comp, master, nextTick=0, raf=0, t0=0, DUR=10;
  function initAudio(){ if(ac) return; var C=window.AudioContext||window.webkitAudioContext; if(!C) return;
    ac=new C(); pre=ac.createGain(); pre.gain.value=4.0;
    comp=ac.createDynamicsCompressor(); comp.threshold.value=-24; comp.knee.value=15; comp.ratio.value=20; comp.attack.value=0.002; comp.release.value=0.25;
    master=ac.createGain(); master.gain.value=0.18; pre.connect(comp); comp.connect(master); master.connect(ac.destination);
  }
  function prime(){ try{initAudio(); if(ac&&ac.state==='suspended'&&ac.resume) return ac.resume();}catch(e){} return Promise.resolve(); }
  function snare(at){
    if(!ac) return; var len=ac.sampleRate*0.16, buf=ac.createBuffer(1,len,ac.sampleRate), data=buf.getChannelData(0);
    for(var i=0;i<len;i++){ data[i]=Math.random()*2-1; }
    var src=ac.createBufferSource(); src.buffer=buf;
    var bp=ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1800; bp.Q.value=0.9;
    var hp=ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=600;
    var g=ac.createGain(); g.gain.setValueAtTime(0.8,at); g.gain.exponentialRampToValueAtTime(0.0001,at+0.14);
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(pre); src.start(at); src.stop(at+0.16);
  }

  function start(){
    DUR=getDur();
    var fill=document.getElementById('pfill'), val=document.getElementById('pval'), sel=document.getElementById('pspeed');
    if(sel){ ['5','10','30'].forEach(function(v){ if(String(DUR)===v) sel.value=v; });
      sel.addEventListener('change', function(){ setDur(parseInt(sel.value,10)||10); start(); }); }
    if(raf) cancelAnimationFrame(raf); t0=performance.now(); nextTick=0;

    function loop(now){
      var frac=(now-t0)/(DUR*1000); if(frac>1) frac=1;
      var value=1-frac; fill.style.width=(value*100)+'%'; val.textContent=value.toFixed(1);
      var bpm=60+(240-60)*(1-value), interval=60/bpm, nowS=now/1000;
      if(!nextTick||nowS>=nextTick){ prime().then(function(){ if(!ac) return; var t=ac.currentTime+0.02; snare(t); }); nextTick=nowS+interval; }
      if(frac>=1){ location.assign(next); return; }
      raf=requestAnimationFrame(loop);
    }
    raf=requestAnimationFrame(loop);
  }

  window.addEventListener('pointerdown', function(){ try{initAudio();}catch(e){} }, {once:true,capture:true});
  document.addEventListener('DOMContentLoaded', start);
})();</script>
</body>
</html>
