<!doctype html>
<html lang="nl"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>blockchain</title>
<style>
  :root{--bg:#000;--fg:#eaeaea;--line:#222;--pad:clamp(12px,3vmin,20px)}
  *{box-sizing:border-box}html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:16px/1.5 ui-monospace,consolas,monospace}
  body{min-height:100dvh;display:flex;flex-direction:column}
  main{padding:calc(env(safe-area-inset-top) + var(--pad)) var(--pad) calc(env(safe-area-inset-bottom) + var(--pad)) var(--pad);display:grid;gap:12px}
  button{padding:.6rem .9rem;border:1px solid var(--line);background:#111;color:var(--fg);border-radius:.5rem}
  pre{border:1px solid var(--line);padding:.75rem;border-radius:.5rem;overflow:auto;margin:0}
</style>
<body>
<main>
  <h1 style="margin:.2rem 0;font-size:1.15rem">blockchain principles</h1>
  <div>hash-koppeling · immutability · transparantie · reset chain (stopknop) · mobile first</div>
  <div>
    <button id="add">add block</button>
    <button id="reset">reset chain (stopknop)</button>
    <a href="/" style="text-decoration:none"><button>home</button></a>
  </div>
  <div>length: <span id="len">0</span> · head: <span id="head">-</span></div>
  <pre id="out"></pre>
</main>
<script>
  const key='the101game_chain';
  async function sha(s){const b=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',b);return [...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,'0')).join('')}
  function load(){try{return JSON.parse(localStorage.getItem(key)||'[]')}catch(_){return[]}}
  function save(c){localStorage.setItem(key,JSON.stringify(c))}
  async function genesis(note='genesis'){const c=[];const prev='0'.repeat(64);const data={note,ts:Date.now()};const hash=await sha(JSON.stringify({i:0,prev,data}));c.push({i:0,prev,data,hash});save(c);return c}
  async function add(data={note:'block'}){let c=load();if(!c.length)c=await genesis('auto-genesis');const i=c.length;const prev=c[c.length-1].hash;const payload={i,prev,data};const hash=await sha(JSON.stringify(payload));c.push({i,prev,data,hash});save(c);return c}
  async function resetChain(){return await genesis('reset by stopknop')}
  function render(){const c=load();len.textContent=String(c.length);head.textContent=c.length?c[c.length-1].hash.slice(0,16)+'…':'-';out.textContent=JSON.stringify(c,null,2)}
  add.onclick=async()=>{await add({ts:Date.now()});render()}
  reset.onclick=async()=>{await resetChain();try{if(window.opener&&window.opener._w0_stop)window.opener._w0_stop()}catch(e){}render()}
  (async()=>{if(!load().length)await genesis('fresh');render()})()
</script>
<script>/* newest-first view */
(function(){
  function load(){ try{ return JSON.parse(localStorage.getItem('the101game_chain')||'[]') }catch(_){ return [] } }
  function fmt(c){ return JSON.stringify(c,null,2); }
  function render(){
    var c = load(); var r = c.slice().reverse(); // newest first
    var out = document.getElementById('out'); if(out) out.textContent = fmt(r);
  }
  document.addEventListener('DOMContentLoaded', render);
})();
</script>
</body></html>

