<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>the101game · choose</title>
<style>
  :root{ --phone-w:min(100vw,420px); --bg:#000; --fg:#eaeaea; --line:#2a2a2a }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 ui-monospace,consolas,monospace}
  #phone{width:var(--phone-w);min-height:100dvh;margin:0 auto;display:flex;flex-direction:column;gap:12px}
  header{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:center}
  #clock{font-weight:700;letter-spacing:.02em}
  main{padding:10px 14px;display:grid;gap:10px}
  .choice{border:2px solid #333;border-radius:12px;padding:1rem;text-align:center;user-select:none;cursor:pointer}
  .choice.en{border-color:#2ee67055}  /* english hint */
  .choice.nl{border-color:#e62e2e55}  /* nederlands hint */
  .choice.selected{box-shadow:0 0 0 2px currentColor inset}
  .choice.en.selected{color:#2ee670;border-color:#2ee670}
  .choice.nl.selected{color:#e62e2e;border-color:#e62e2e}
  body.caps-on  #phone{ text-transform:uppercase }
  body.caps-off #phone{ text-transform:lowercase }
  /* red dot */
  #reddot{
    position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom) + 16px);transform:translateX(-50%);
    width:64px;height:64px;border-radius:50%;background:#ff2a2a;
    box-shadow:0 0 0 2px rgba(255,42,42,.25), 0 0 16px rgba(255,42,42,.6);
    display:grid;place-items:center;cursor:pointer;user-select:none
  }
  #reddot:active{transform:translateX(-50%) scale(.96)}
  footer{height:72px} /* spacer for dot */
</style>
<body class="caps-off">
<div id="phone">
  <header><div id="clock">—</div></header>
  <main>
    <div id="en" class="choice en selected">CASE 0: ENGLISH</div>
    <div id="nl" class="choice nl">case 1: nederlands</div>
  </main>
  <footer></footer>
</div>
<div id="reddot" aria-label="toggle caps (red dot)" role="button" tabindex="0"></div>

<script>
(function(){
  /* -------- clock (dd mmmm yyyy HH:MM:SS) -------- */
  function pad(n){ return (n<10?'0':'')+n }
  const months = ['january','february','march','april','may','june','july','august','september','october','november','december'];
  function fmtDate(d){
    const dd=pad(d.getDate()), m=months[d.getMonth()], y=d.getFullYear();
    const HH=pad(d.getHours()), MM=pad(d.getMinutes()), SS=pad(d.getSeconds());
    return dd+' '+m+' '+y+' '+HH+':'+MM+':'+SS;
  }
  const clock = document.getElementById('clock');
  function tick(){ const now=new Date(); clock.textContent = fmtDate(now); }
  tick(); setInterval(tick, 250);

  /* -------- lang choose -------- */
  let choice = (localStorage.getItem('site_lang') || 'en');
  const enEl = document.getElementById('en');
  const nlEl = document.getElementById('nl');
  function applyChoice(lang){
    choice = lang;
    localStorage.setItem('site_lang', lang);
    document.documentElement.setAttribute('lang', lang);
    enEl.classList.toggle('selected', lang==='en');
    nlEl.classList.toggle('selected', lang==='nl');
  }
  enEl.onclick = ()=>{ applyChoice('en'); chime(); };
  nlEl.onclick = ()=>{ applyChoice('nl'); chime(); };
  applyChoice(choice);

  /* -------- audio + caps toggle (red dot == CapsLock) -------- */
  let ac, pre, master;
  function initAudio(){ if(ac) return;
    const C=window.AudioContext||window.webkitAudioContext; if(!C) return;
    ac=new C(); pre=ac.createGain(); pre.gain.value=3.5; master=ac.createGain(); master.gain.value=0.2;
    pre.connect(master); master.connect(ac.destination);
  }
  function prime(){ try{initAudio(); if(ac&&ac.state==='suspended'&&ac.resume) return ac.resume();}catch(_){ } return Promise.resolve(); }
  function blip(freq,dur){
    if(!ac) return; const t=ac.currentTime+0.01, o=ac.createOscillator(), g=ac.createGain();
    o.type='square'; o.frequency.value=freq;
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.9,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
    o.connect(g); g.connect(pre); o.start(t); o.stop(t+dur+0.02);
  }
  function tik(){ prime().then(()=>blip(950,0.08)); }   // lower
  function tok(){ prime().then(()=>blip(1350,0.10)); }  // UPPER
  function chime(){ prime().then(()=>{ blip(880,0.10); setTimeout(()=>blip(1320,0.08), 30); }); }

  function getCaps(){ try{ return localStorage.getItem('caps_state')==='1'; }catch(_){ return false; } }
  function setCaps(on){
    try{ localStorage.setItem('caps_state', on?'1':'0'); }catch(_){}
    document.body.classList.toggle('caps-on',  !!on);
    document.body.classList.toggle('caps-off', !on);
  }
  function toggleCaps(){ const on = !getCaps(); setCaps(on); on?tok():tik(); }

  // bind red dot + keyboard
  const rd = document.getElementById('reddot');
  rd.addEventListener('click', toggleCaps);
  rd.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggleCaps(); }});
  window.addEventListener('keydown', e=>{ if(e.key==='CapsLock'){ e.preventDefault(); toggleCaps(); } });

  // prime audio on first gesture
  window.addEventListener('pointerdown', ()=>prime(), {once:true,capture:true});
  window.addEventListener('keydown',    ()=>prime(), {once:true,capture:true});

  // initialize caps state from storage
  setCaps(getCaps());

  /* -------- auto-forward after 30s -------- */
  const DURATION_MS = 30000;
  setTimeout(()=>{
    // hint next page that audio may start immediately
    try{
      localStorage.setItem('w_audio_intent','1');
      localStorage.setItem('w_audio_intent_ts', String(Date.now()));
    }catch(_){}
    location.assign('/w0l0.html');
  }, DURATION_MS);
})();
</script>
</body>
</html>
