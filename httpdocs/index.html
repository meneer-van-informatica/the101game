<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>LONELY WOLF</title>
<style>
  :root{ --phone-w:min(100vw,420px); --bg:#000; --fg:#eaeaea; --line:#2a2a2a }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 ui-monospace,consolas,monospace}
  #phone{width:var(--phone-w);min-height:100dvh;margin:0 auto;display:flex;flex-direction:column;gap:12px}
  header{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:center}
  #clock{font-weight:700;letter-spacing:.02em}
  main{padding:10px 14px;display:grid;gap:10px}
  .choice{border:2px solid #333;border-radius:12px;padding:1rem;text-align:center;user-select:none;cursor:pointer}
  .choice.en{border-color:#2ee67055}  /* english hint */
  .choice.nl{border-color:#e62e2e55}  /* nederlands hint */
  .choice.selected{box-shadow:0 0 0 2px currentColor inset}
  .choice.en.selected{color:#2ee670;border-color:#2ee670}
  .choice.nl.selected{color:#e62e2e;border-color:#e62e2e}
  body.caps-on  #phone{ text-transform:uppercase }
  body.caps-off #phone{ text-transform:lowercase }
  /* red dot */
  #reddot{
    position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom) + 16px);transform:translateX(-50%);
    width:64px;height:64px;border-radius:50%;background:#ff2a2a;
    box-shadow:0 0 0 2px rgba(255,42,42,.25), 0 0 16px rgba(255,42,42,.6);
    display:grid;place-items:center;cursor:pointer;user-select:none
  }
  #reddot:active{transform:translateX(-50%) scale(.96)}
  footer{height:72px} /* spacer for dot */
</style>
<body class="caps-off">
<div id="phone">
<div id='clock'></div>
<div id='asciibar' aria-label='ascii progress'>[<span class='g'></span><span class='r'></span>] 1.0</div>
<div id='clock'></div><div class='secwrap'><div id='secbar'><div class='fill' id='secfill'></div><div class='val' id='secval'>1.0</div></div></div>
  <header><div id="clock">—</div></header>
  <main>
    <div id="en" class="choice en selected">CASE 0: ENGLISH</div>
    <div id="nl" class="choice nl">case 1: nederlands</div>
  </main>
  <footer></footer>
</div>
<div id="reddot" aria-label="toggle caps (red dot)" role="button" tabindex="0"></div>

<script>
(function(){
  /* -------- clock (dd mmmm yyyy HH:MM:SS) -------- */
  function pad(n){ return (n<10?'0':'')+n }
  const months = ['january','february','march','april','may','june','july','august','september','october','november','december'];
  function fmtDate(d){
    const dd=pad(d.getDate()), m=months[d.getMonth()], y=d.getFullYear();
    const HH=pad(d.getHours()), MM=pad(d.getMinutes()), SS=pad(d.getSeconds());
    return dd+' '+m+' '+y+' '+HH+':'+MM+':'+SS;
  }
  const clock = document.getElementById('clock');
  function tick(){ const now=new Date(); clock.textContent = fmtDate(now); }
  tick(); setInterval(tick, 250);

  /* -------- lang choose -------- */
  let choice = (localStorage.getItem('site_lang') || 'en');
  const enEl = document.getElementById('en');
  const nlEl = document.getElementById('nl');
  function applyChoice(lang){
    choice = lang;
    localStorage.setItem('site_lang', lang);
    document.documentElement.setAttribute('lang', lang);
    enEl.classList.toggle('selected', lang==='en');
    nlEl.classList.toggle('selected', lang==='nl');
  }
  enEl.onclick = ()=>{ applyChoice('en'); chime(); };
  nlEl.onclick = ()=>{ applyChoice('nl'); chime(); };
  applyChoice(choice);

  /* -------- audio + caps toggle (red dot == CapsLock) -------- */
  let ac, pre, master;
  function initAudio(){ if(ac) return;
    const C=window.AudioContext||window.webkitAudioContext; if(!C) return;
    ac=new C(); pre=ac.createGain(); pre.gain.value=3.5; master=ac.createGain(); master.gain.value=0.2;
    pre.connect(master); master.connect(ac.destination);
  }
  function prime(){ try{initAudio(); if(ac&&ac.state==='suspended'&&ac.resume) return ac.resume();}catch(_){ } return Promise.resolve(); }
  function blip(freq,dur){
    if(!ac) return; const t=ac.currentTime+0.01, o=ac.createOscillator(), g=ac.createGain();
    o.type='square'; o.frequency.value=freq;
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.9,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
    o.connect(g); g.connect(pre); o.start(t); o.stop(t+dur+0.02);
  }
  function tik(){ prime().then(()=>blip(950,0.08)); }   // lower
  function tok(){ prime().then(()=>blip(1350,0.10)); }  // UPPER
  function chime(){ prime().then(()=>{ blip(880,0.10); setTimeout(()=>blip(1320,0.08), 30); }); }

  function getCaps(){ try{ return localStorage.getItem('caps_state')==='1'; }catch(_){ return false; } }
  function setCaps(on){
    try{ localStorage.setItem('caps_state', on?'1':'0'); }catch(_){}
    document.body.classList.toggle('caps-on',  !!on);
    document.body.classList.toggle('caps-off', !on);
  }
  function toggleCaps(){ const on = !getCaps(); setCaps(on); on?tok():tik(); }

  // bind red dot + keyboard
  const rd = document.getElementById('reddot');
  rd.addEventListener('click', toggleCaps);
  rd.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggleCaps(); }});
  window.addEventListener('keydown', e=>{ if(e.key==='CapsLock'){ e.preventDefault(); toggleCaps(); } });

  // prime audio on first gesture
  window.addEventListener('pointerdown', ()=>prime(), {once:true,capture:true});
  window.addEventListener('keydown',    ()=>prime(), {once:true,capture:true});

  // initialize caps state from storage
  setCaps(getCaps());

  /* -------- auto-forward after 30s -------- */
  const DURATION_MS = 30000;
  setTimeout(()=>{
    // hint next page that audio may start immediately
    try{
      localStorage.setItem('w_audio_intent','1');
      localStorage.setItem('w_audio_intent_ts', String(Date.now()));
    }catch(_){}
    if(!window._holdTime){ location.assign('/w0l0.html'); } else { window._navReady=true; }
  }, DURATION_MS);
})();
</script>
<script>
/* 10s seconds bar engine */
(function(){
  // standaard: 10s voor keuze 0 (LANG)
  var DUR = 10_000;
  var t0  = 0, raf = 0, routed = false;

  function fmtDate(d){
    const m = ['january','february','march','april','may','june','july','august','september','october','november','december'];
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = m[d.getMonth()];
    const yyyy = d.getFullYear();
    const HH = String(d.getHours()).padStart(2,'0');
    const MM = String(d.getMinutes()).padStart(2,'0');
    const SS = String(d.getSeconds()).padStart(2,'0');
    return dd+' '+mm+' '+yyyy+' '+HH+':'+MM+':'+SS;
  }

  function updateClock(){
    var el = document.getElementById('clock');
    if (el) el.textContent = fmtDate(new Date());
  }

  function loop(now){
    updateClock();

    if (!t0) t0 = now;
    var frac = (now - t0) / DUR; if (frac > 1) frac = 1;
    var value = 1 - frac; // 1.0 → 0.0
    var fill  = document.getElementById('secfill');
    var val   = document.getElementById('secval');
    if (fill) fill.style.width = (value*100) + '%';
    if (val)  val.textContent  = value.toFixed(1);

    if (frac >= 1 && !routed){
      routed = true;
      // taal al gezet via tiles/red dot; fallback op en
      try{ if(!localStorage.getItem('site_lang')) localStorage.setItem('site_lang','en'); }catch(_){}
      if(!window._holdTime){ location.assign('/w0l0.html'); } else { window._navReady=true; }
      return;
    }
    raf = requestAnimationFrame(loop);
  }

  // tik-tok per seconde (snare-achtig) – hergebruik bestaande audio prime indien aanwezig
  var ac, pre;
  function initAudio(){
    if (ac) return;
    var C = window.AudioContext || window.webkitAudioContext;
    if (!C) return;
    ac = new C();
    pre = ac.createGain(); pre.gain.value = 3.5;
    pre.connect(ac.destination);
  }
  function prime(){ try{ initAudio(); if (ac.state==='suspended'&&ac.resume) return ac.resume(); }catch(e){} }
  function snareTick(){
    if(!ac) return;
    var t = ac.currentTime + 0.02;
    var len = ac.sampleRate*0.12, buf = ac.createBuffer(1,len,ac.sampleRate), data = buf.getChannelData(0);
    for (var i=0;i<len;i++){ data[i] = Math.random()*2-1; }
    var src = ac.createBufferSource(); src.buffer = buf;
    var hp = ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=800;
    var g = ac.createGain(); g.gain.setValueAtTime(0.7,t); g.gain.exponentialRampToValueAtTime(0.0001,t+0.12);
    src.connect(hp); hp.connect(g); g.connect(pre); src.start(t); src.stop(t+0.14);
  }

  // 1) start animatie, 2) klok elke seconde, 3) audio bij 1e interactie en elke seconde
  document.addEventListener('DOMContentLoaded', function(){
    requestAnimationFrame(loop);
    updateClock();
    setInterval(function(){ updateClock(); prime(); snareTick(); }, 1000);
  });
  window.addEventListener('pointerdown', function(){ prime(); }, {once:true, capture:true});
  window.addEventListener('keydown',     function(){ prime(); }, {once:true, capture:true});
})();
</script>
<script>
/* ascii bar + color swapper */
(function(){
  // apply stored swap on load
  function applySwap(flag){
    document.body.classList.toggle('swap', !!flag);
    try{ localStorage.setItem('swap_colors', flag ? '1' : '0'); }catch(_){}
  }
  function loadSwap(){ try{ return localStorage.getItem('swap_colors')==='1'; }catch(_){ return false } }

  // hook red dot: naast je bestaande click handler ook swap togglen
  function bindSwap(){
    var dot = document.getElementById('reddot');
    if(!dot) return;
    dot.addEventListener('click', function(){
      var on = !document.body.classList.contains('swap');
      applySwap(on);
    });
  }

  // ascii progress rendert mee met je bestaande 10s engine (leest #secval)
  function renderAscii(val){
    var el = document.getElementById('asciibar'); if(!el) return;
    var total = 24;                           // aantal ascii kolommen
    var fillN = Math.max(0, Math.min(total, Math.round(val * total)));
    var g = '█'.repeat(fillN);
    var r = '░'.repeat(total - fillN);
    el.innerHTML = "[<span class='g'>" + g + "</span><span class='r'>" + r + "</span>] " + val.toFixed(1);
  }
  function asciiLoop(){
    var vTxt = document.getElementById('secval')?.textContent || '1';
    var v = parseFloat(vTxt); if (isNaN(v)) v = 1;
    renderAscii(v);
    requestAnimationFrame(asciiLoop);
  }

  document.addEventListener('DOMContentLoaded', function(){
    applySwap(loadSwap());
    bindSwap();
    requestAnimationFrame(asciiLoop);
  });
})();
</script>
<div id='dot-red'   aria-label='red · english · caps · stop'><span>RED</span></div>
<div id='dot-green' aria-label='green · nederlands · lower · go'><span>GREEN</span></div>
<script>
/* two dots logic */
(function(){
  // --- tiny audio core re-use (snare-ish tick) ---
  var AC = window.AudioContext||window.webkitAudioContext, ac, pre, comp;
  function audio(){ if(ac) return ac; if(!AC) return null; ac = new AC();
    pre=ac.createGain(); pre.gain.value=4.0;
    comp=ac.createDynamicsCompressor(); comp.threshold.value=-24; comp.knee.value=15; comp.ratio.value=20; comp.attack.value=0.002; comp.release.value=0.25;
    pre.connect(comp); comp.connect(ac.destination); return ac;
  }
  function prime(){ var a=audio(); if(!a) return Promise.resolve(); try{ if(a.state==='suspended'&&a.resume) return a.resume(); }catch(e){} return Promise.resolve(); }
  function tone(freq,dur){
    if(!audio()) return;
    var t=ac.currentTime, o=ac.createOscillator(), g=ac.createGain();
    o.type='square'; o.frequency.value=freq;
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.9,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
    o.connect(g); g.connect(pre); o.start(t); o.stop(t+dur+0.02);
  }
  function TIK(){ prime().then(function(){ tone(1600,0.06); }); } // red
  function TOK(){ prime().then(function(){ tone(800,0.08);  }); } // green

  // --- state ---
  var langKey='site_lang';
  function setLang(l){ try{localStorage.setItem(langKey,l);}catch(e){} document.documentElement.setAttribute('lang',l); }
  function getLang(){ try{return localStorage.getItem(langKey)||'en';}catch(e){return 'en'} }

  // Caps toggle as body class (in combinatie met jouw huidige content)
  function setCaps(on){
    document.body.classList.toggle('caps-on',  !!on);
    document.body.classList.toggle('caps-off', !on);
  }

  // Timer hold: stop nav bij einde; groene dot laat doorgaan
  window._holdTime = false;
  window._navReady = false;

  // Patch jouw auto-navigate naar w0l0: als er een oude regel zonder guard staat, vervang die inline
  // (idempotent noop als al gepatcht)
  try{
    if (!window.__navGuardPatched) {
      // monkey: intercept location.assign calls die exact naar /w0l0.html gaan
      var _assign = window.location.assign.bind(window.location);
      window.location.assign = function(url){
        if (typeof url === 'string' && url.indexOf('/w0l0.html') !== -1) {
          if (window._holdTime) { window._navReady = true; return; }
        }
        _assign(url);
      };
      window.__navGuardPatched = true;
    }
  }catch(_){}

  // Dots binding
  function bindDots(){
    var red   = document.getElementById('dot-red');
    var green = document.getElementById('dot-green');
    if (!red || !green) return;

    red.addEventListener('click', function(){
      setLang('en');        // english
      setCaps(true);        // CAPS
      window._holdTime = true;  // time stop
      TIK();                // tik
    });
    green.addEventListener('click', function(){
      setLang('nl');        // nederlands
      setCaps(false);       // lower
      window._holdTime = false; // time go
      TOK();                // tok
      if (window._navReady){ window._navReady=false; if(!window._holdTime){ location.assign('/w0l0.html'); } else { window._navReady=true; } } // ga alsnog
    });
  }

  document.addEventListener('DOMContentLoaded', function(){
    // initial: default RED semantics (english + caps + hold) of behoud bestaande keuze
    var L = getLang();
    setLang(L);
    setCaps(L==='en');             // en => caps, nl => lower
    bindDots();
    // prime eenmalig zodat chime/ticks straks mogen
    window.addEventListener('pointerdown', function(){ prime(); }, {once:true,capture:true});
  });
})();
</script>
</body>
</html>



