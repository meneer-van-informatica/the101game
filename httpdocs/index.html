<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>the101game · KM</title>
<style>
  :root{--w:min(100vw,420px);--bg:#000;--fg:#fff;--line:#fff}
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.35 ui-monospace,consolas,monospace}
  #phone{width:var(--w);min-height:100dvh;margin:0 auto;display:flex;flex-direction:column;padding:14px}
  header{display:flex;justify-content:center}
  #clock{border:1px solid var(--line);border-radius:10px;padding:8px 12px;min-width:60%;text-align:center}
  main{flex:1;display:grid;gap:12px;align-content:start;margin-top:18px}
  .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  .choices{display:grid;gap:8px;margin-top:8px}
  .btn{display:block;width:100%;padding:.9rem 1rem;border:1px solid var(--line);border-radius:10px;background:#000;color:#fff;text-align:center;cursor:pointer}
  .hint{opacity:.8;margin-top:6px}
  footer{padding:20px 0 calc(env(safe-area-inset-bottom)+10px) 0;text-align:center;opacity:.8}
</style>
<body>
<div id="phone">
  <header><div id="clock">--:--:--</div></header>

  <main>
    <section class="card">
      <b id="title">KM — choose language</b>
      <div class="choices">
        <button id="en" class="btn">CASE 0: ENGLISH</button>
        <button id="nl" class="btn">kees 1: nederlands</button>
      </div>
      <div class="hint">tip: press 0 or 1 · dogs vs. cats fights for kukels</div>
    </section>

    <section class="card" style="opacity:.9">
      <b>dogs vs. cats — kukels</b>
      <div id="score" style="margin-top:6px">loading…</div>
    </section>
  </main>

  <footer>genesis (index) = 0 kukel — w0l0 = 1 kukel</footer>
</div>

<script>
(function(){
  function z(n){return String(n).padStart(2,'0')}
  function tick(){
    var c=document.getElementById('clock'); if(!c) return;
    var d=new Date(); c.textContent = z(d.getHours())+':'+z(d.getMinutes())+':'+z(d.getSeconds());
    setTimeout(tick,500);
  }
  tick();

  // tiny local chain (LMW), page worth = 0 (index)
  async function sha(s){const b=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',b);return [...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,'0')).join('')}
  function load(){try{return JSON.parse(localStorage.getItem('the101game_chain')||'[]')}catch(_){return []}}
  function save(c){localStorage.setItem('the101game_chain',JSON.stringify(c));try{localStorage.setItem('kukel_total',String(c.length))}catch(_){}}  
  async function ensureGenesis(){
    let c=load(); if(c.length) return c;
    const data={owner:'LMW',path:'/genesis',worth:0,ts:Date.now(),note:'start'};
    const prev='0'.repeat(64), hash=await sha(JSON.stringify({i:0,prev,data}));
    c=[{i:0,prev,data,hash}]; save(c); return c;
  }
  (async()=>{
    const L = (localStorage.getItem('site_lang')||'en');
    let c = await ensureGenesis();
    const i=c.length, prev=c[c.length-1].hash, data={owner:'LMW',path:location.pathname,worth:0,lang:L,ts:Date.now()};
    const hash=await sha(JSON.stringify({i,prev,data})); c.push({i,prev,data,hash}); save(c);
  })();

  // dogs vs cats mini-score (placeholder: counts even/odd blocks as dog/cat)
  function renderScore(){
    const c = load();
    let dogs=0,cats=0;
    c.forEach(b=>{ (b.i%2===0) ? dogs++ : cats++; });
    const el=document.getElementById('score');
    if(el) el.textContent = 'dogs: '+dogs+' · cats: '+cats+' · total kukels: '+c.length;
  }
  renderScore();

  // KM — choose language
  function choose(lang){
    try{ localStorage.setItem('site_lang',lang); }catch(_){}
    location.assign('/w0l0.html');
  }
  document.getElementById('en')?.addEventListener('click', ()=>choose('en'));
  document.getElementById('nl')?.addEventListener('click', ()=>choose('nl'));
  window.addEventListener('keydown', e=>{
    if(e.key==='0') choose('en');
    if(e.key==='1') choose('nl');
  });

  // label tweak per stored lang
  (function applySaved(){
    const L = localStorage.getItem('site_lang')||'en';
    const t = document.getElementById('title');
    if(L==='nl'){ document.documentElement.setAttribute('lang','nl'); if(t) t.textContent='KM — kies taal'; }
    else        { document.documentElement.setAttribute('lang','en'); if(t) t.textContent='KM — choose language'; }
  })();
})();
</script>
</body>
</html>
