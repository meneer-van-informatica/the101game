<!doctype html>
<html lang='nl'>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no'>
<meta name='theme-color' content='#000000'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'>
<meta name='app-version' content='20250912141740'>
<link rel='manifest' href='/manifest.webmanifest'>
<title>the101game · webapp</title>
<style>/* quick-lang css */
#lang-quick{display:flex;gap:12px;margin:.75rem 0;flex-wrap:wrap}
#lang-quick .langbtn{flex:1 1 160px;padding:.75rem 1rem;border:1px solid #333;background:#111;color:#eaeaea;border-radius:10px;font-weight:600;text-transform:lowercase}
@media (prefers-color-scheme:light){
  #lang-quick .langbtn{background:#f7f7f7;color:#111;border-color:#ccc}
}
</style>
<style>/* phone frame css */
:root{ --phone-w: min(100vw, 420px); --bg:#000; --fg:#eaeaea }
html,body{background:var(--bg);color:var(--fg)}
/* container die op desktop centreert en op mobiel fullscreen is */
#phone{ width:var(--phone-w); min-height:100dvh; margin:0 auto; position:relative }
@supports (height: 100dvh){ #phone{ min-height:100dvh } }
/* fixed elementen binnen het frame begrenzen */
#phone .fit-x{ left:0; right:0; }
@media (min-width:600px){
  body{ display:grid; place-items:start center; }
}
/* zorg dat bars die 'fixed' zijn niet meer de volle breedte pakken */
.bar{ inset:auto auto auto auto; width:100%; max-width:var(--phone-w); margin:0 auto }
</style>
<link rel='stylesheet' href='/stippy/stippy.css'>
<style>
  :root{--bg:#000;--fg:#eaeaea;--muted:#8a8a8a;--line:#222;--accent:#ffd400;--pad:clamp(8px,2.5vmin,16px);--fs:clamp(14px,2.2vmax,22px);--fs-lg:clamp(18px,3.2vmax,28px)}
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:var(--fs)/1.35 ui-monospace,consolas,monospace}
  body{min-height:100dvh;display:flex;flex-direction:column}
  .safe{padding:calc(env(safe-area-inset-top) + var(--pad)) calc(env(safe-area-inset-right) + var(--pad)) calc(env(safe-area-inset-bottom) + var(--pad)) calc(env(safe-area-inset-left) + var(--pad))}
  header{display:flex;justify-content:space-between;gap:12px;align-items:center;border-bottom:1px solid var(--line)}
  header .brand{letter-spacing:.5px}
  header .dot{width:.6rem;height:.6rem;border-radius:50%;background:var(--accent);display:inline-block;margin-left:.5rem}
  main{flex:1;display:flex;flex-direction:column;gap:10px}
  \.block{padding:8px 0;border-bottom:1px dashed var(--line)}
  .block:last-child{border-bottom:none}
  .label{opacity:.6}
  .value{font-size:var(--fs-lg);white-space:pre-wrap}
  #tetris{display:none;width:100%;border:1px dashed var(--line);margin-top:8px;aspect-ratio:1/10;position:relative;overflow:auto}
  #tgrid{position:absolute;inset:0;display:grid;grid-template-columns:repeat(40,1fr);grid-template-rows:repeat(400,1fr)}
  #tgrid div{outline:1px solid #111;background:transparent}
  footer{opacity:.7;font-size:.9em;margin-top:auto}
  .hint{color:var(--muted)}
  header .icon{background:none;border:0;padding:0;margin-left:.75rem}
  header .icon svg{display:block;width:1.2rem;height:1.2rem}
</style>
<body class='safe'><div id="phone">
  <header>
    <div class='brand'>the101game<span class='dot' aria-hidden='true'></span></div>
    <div class='hint'>mobile · webapp · pwa</div>
  <button id='favicon-btn' class='icon' title='favicon' aria-label='favicon'><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='10' fill='#ff2a2a'/></svg></button>
</header>

  <main id='screen' aria-label='app screen'>
<section id='lang-quick'>
  <button id='choose-en' class='langbtn'>english</button>
  <button id='choose-nl' class='langbtn'>nederlands</button>
</section>
    <section class='block'><div class='label'>side</div><div class='value' data-key='side'>i am right</div></section>
    <section class='block'><div class='label'>case</div><div class='value' data-key='case'>i am lowercase</div></section>
    <section class='block'><div class='label'>name</div><div class='value' data-key='name'>i am bert</div></section>
    <section class='block'><div class='label'>ernie</div><div class='value' data-key='ernie'>ernie is not here</div></section>
    <section class='block'><div class='label'>left</div><div class='value' data-key='left'>he is left</div></section>
    <section class='block'><div class='label'>note</div><div class='value' data-key='note'>this is a webapp. mobile is default.</div></section>

    <!-- optional tetris (40x400). enable by removing display:none on #tetris -->
    <section class='block' id='tetris' aria-label='tetris 40x400'><div id='tgrid'></div></section>
  </main>

  <footer><div class='hint'>console: set('name','i am bert, lowercase forever')</div></footer>

<script>
  const key='w0l0_identity';
  function apply(){const m=JSON.parse(localStorage.getItem(key)||'{}');for(const k in m){const el=document.querySelector('[data-key="'+k+'"]');if(el) el.textContent=m[k];}}
  window.set=function(k,v){const m=JSON.parse(localStorage.getItem(key)||'{}');m[k]=v;localStorage.setItem(key,JSON.stringify(m));apply();return 'ok'}
  window.slot=function(k,v){return window.set(k,v)}
  ;(function(){const g=document.getElementById('tgrid');if(!g)return;const n=40*400,f=document.createDocumentFragment();for(let i=0;i<n;i++)f.appendChild(document.createElement('div'));g.appendChild(f)})();
  if('serviceWorker'in navigator){navigator.serviceWorker.register('/sw.js').catch(()=>{})}
  apply();
</script>
<div id='stippy' aria-hidden='true'></div>
<script src='/stippy/stippy.js' defer></script>
<script src='/stippy/w0l0-nav.js?v=20250912141740' defer></script>
<script>
// sw auto refresh hook
(function(){
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js').then(reg=>{
      // force page reload once when new controller takes over
      let refreshed = false;
      navigator.serviceWorker.addEventListener('controllerchange', ()=>{
        if(refreshed) return; refreshed = true; location.reload();
      });
      // ask current sw for version (optional)
      if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({type:'GET_VER'});
      }
      navigator.serviceWorker.addEventListener('message', ev=>{
        if(ev.data && ev.data.type==='VER'){ console.log('sw', ev.data.ver); }
      });
    }).catch(()=>{});
  }
})();
</script>
<script>
/* index bg-audio + tap nav */
(function(){
  // ---------- audio core ----------
  let ac, preGain, comp, master;
  function initAudio(){ if(ac) return;
    ac=new (window.AudioContext||window.webkitAudioContext)();
    preGain=ac.createGain(); preGain.gain.value=4.0;
    comp=ac.createDynamicsCompressor(); comp.threshold.value=-24; comp.knee.value=15; comp.ratio.value=20; comp.attack.value=0.002; comp.release.value=0.25;
    master=ac.createGain(); master.gain.value=0.0; // stil op index
    preGain.connect(comp); comp.connect(master); master.connect(ac.destination);
  }
  async function ensureAudio(){ try{ initAudio(); if(ac.state==='suspended') await ac.resume(); }catch(_){} }
  function setVol01(v){ if(!master) return; master.gain.value=Math.max(0,Math.min(1.5,v)); }

  // ---------- tone helpers ----------
  const W=40,H=400; const FALL_SLOW=3000, FALL_FAST=900, SPAWN_MS=5000;
  function freqForX(x){ const f0=261.63, span=24, semi=(x/(W-1))*span; return f0*Math.pow(2, semi/12); }
  function currentFallMs(){ const s=(new Date()).getSeconds(); const a=s/59; return FALL_SLOW + (FALL_FAST - FALL_SLOW)*a; }
  function tickSound(x,y){
    try{ initAudio(); }catch(_){}
    if(!ac) return;
    const t=ac.currentTime, f=freqForX(x||0)*(0.85+0.3*((y||0)/H));
    const o=ac.createOscillator(), g=ac.createGain();
    o.type='square'; o.frequency.setValueAtTime(f,t);
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(1,t+0.004); g.gain.exponentialRampToValueAtTime(0.0001,t+0.06);
    o.connect(g); g.connect(preGain); o.start(t); o.stop(t+0.08);
  }
  function chord(x){
    try{ initAudio(); }catch(_){}
    if(!ac) return;
    const root=freqForX(x), t0=ac.currentTime+0.02;
    [0,4,7].forEach((i,k)=>{ const o=ac.createOscillator(), g=ac.createGain(); o.type='triangle'; o.frequency.value=root*Math.pow(2,i/12);
      g.gain.setValueAtTime(0,t0); g.gain.linearRampToValueAtTime(0.9,t0+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t0+0.35);
      o.connect(g); g.connect(preGain); o.start(t0+k*0.004); o.stop(t0+0.4); });
  }

  // ---------- bg fall loop (sound only, seconds-driven) ----------
  (function runBg(){
    // probeer stil te starten; als intent gezet is door taalmodal is dit meestal direct toegestaan
    ensureAudio().then(()=>setVol01(0.0));
    // seeded maar simpel
    let x = Math.floor(Math.random()*W);
    let blockStart = performance.now();
    chord(x);
    function loop(now){
      const fm = currentFallMs();
      const tIn = (now - blockStart);
      const y   = Math.max(0, Math.min(H, (tIn/fm)*H));
      // tik elke 12 rijen
      const step=12; const phase=Math.floor(y/step);
      if(loop._p !== phase){ loop._p = phase; tickSound(x,y); }
      // nieuw blok
      if (tIn >= SPAWN_MS){
        blockStart = now;
        x = Math.floor(Math.random()*W);
        chord(x);
      }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  })();

  // ---------- tap = tik + 10 taps -> /w0l0.html ----------
  let tapCount = 0, tapTimer=null;
  function tap(){
    tapCount++;
    // tik-sound op tap
    ensureAudio().then(()=>{ setVol01(Math.max(0.15, master?.gain?.value||0)); tickSound(0,0); });
    // reset window
    clearTimeout(tapTimer); tapTimer=setTimeout(()=>{ tapCount=0; }, 6000);
    if (tapCount >= 10){
      tapCount = 0;
      // bepaal taal/bericht
      const L = localStorage.getItem('site_lang') || 'en';
      if (L === 'nl'){
        localStorage.setItem('w_msg_text','hallo mama');
        localStorage.setItem('w_msg_case','1');
      } else {
        localStorage.setItem('w_msg_text','HELLO MAMA');
        localStorage.setItem('w_msg_case','0');
      }
      // laat w0l0 weten dat audio gewoon door mag
      localStorage.setItem('w_audio_continue','1');
      localStorage.setItem('w_audio_intent_ts', String(Date.now()));
      location.assign('/w0l0.html');
    }
  }
  window.addEventListener('pointerdown', tap, {passive:true});

  // ---------- koppel taalmodal-knoppen ook aan audio intent ----------
  (function bindIntent(){
    function unlockAudioIntent(){
      try{
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC){
          const a = new AC(), g=a.createGain(); g.gain.value=0.0001;
          const o=a.createOscillator(); o.type='sine'; o.frequency.value=440;
          o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime+0.01);
          a.resume?.(); setTimeout(()=>{ try{ a.close(); }catch(_){ } }, 30);
        }
      }catch(_){}
      localStorage.setItem('w_audio_intent','1');
      localStorage.setItem('w_audio_intent_ts', String(Date.now()));
    }
    function bind(){
      document.getElementById('btn-en')?.addEventListener('click', unlockAudioIntent);
      document.getElementById('btn-nl')?.addEventListener('click', unlockAudioIntent);
    }
    if (document.readyState==='complete'||document.readyState==='interactive') bind();
    else document.addEventListener('DOMContentLoaded', bind, {once:true});
  })();
})();
</script>
</div><script>
/* quick-lang go */
(function(){
  function primeAudioIntent(){
    try{
      const AC = window.AudioContext || window.webkitAudioContext;
      if (AC){
        const a = new AC(), g=a.createGain(); g.gain.value=0.0001;
        const o=a.createOscillator(); o.type='sine'; o.frequency.value=440;
        o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime+0.01);
        a.resume?.(); setTimeout(()=>{ try{ a.close(); }catch(_){ } }, 30);
      }
    }catch(_){}
    localStorage.setItem('w_audio_intent','1');
    localStorage.setItem('w_audio_intent_ts', String(Date.now()));
  }
  function choose(lang){
    localStorage.setItem('site_lang', lang);
    if (lang==='nl'){ localStorage.setItem('w_msg_text','hallo mama'); localStorage.setItem('w_msg_case','1'); }
    else            { localStorage.setItem('w_msg_text','HELLO MAMA'); localStorage.setItem('w_msg_case','0'); }
    primeAudioIntent();
    location.assign('/w0l0.html');
  }
  function bind(){
    document.getElementById('choose-en')?.addEventListener('click', ()=>choose('en'));
    document.getElementById('choose-nl')?.addEventListener('click', ()=>choose('nl'));
  }
  if (document.readyState==='complete'||document.readyState==='interactive') bind();
  else document.addEventListener('DOMContentLoaded', bind, {once:true});
})();
</script>
</body>
</html>











