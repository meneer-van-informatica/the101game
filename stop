#!/usr/bin/env bash
set -euo pipefail
REPO=/root/the101game
cd "$REPO"

# 1) OFFLINE vlag
sudo touch /etc/nginx/.OFFLINE
echo "[STOP] OFFLINE vlag gezet"
sudo nginx -t && sudo systemctl reload nginx

# 2) VERS
VERS=$(vers)
STAMP=$(TZ=Europe/Amsterdam date +%Y-%m-%dT%H:%M:%S%z)
BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo main)

echo "VERS=$VERS" > VERSION.txt
echo "STAMP=$STAMP" >> VERSION.txt
echo "BRANCH=$BRANCH" >> VERSION.txt

git add -A
git commit -m "$STAMP" || echo "[GIT] geen wijzigingen"
git pull --rebase --autostash lmw "$BRANCH" || true
git push lmw "$BRANCH" || true

echo "[OK] Onderhoud actief. VERS=$VERS gepusht."
